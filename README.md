# SSH Gate

Веб-приложение для управления пользователями и их доступом к серверам по SSH. Backend написан на Go, frontend — на Vue 3. Публичные ключи пользователей автоматически добавляются на выбранные серверы.

## Требования

- Go 1.24+
- Node.js 20+ для сборки интерфейса
- Доступ к управляемым серверам по SSH

## Установка

1. Сборка фронтенда:

   ```bash
   cd frontend
   npm install
   npm run build
   ```

   Скомпилированные файлы будут расположены в каталоге `frontend/dist`.

2. Подготовка бэкенда:

   ```bash
   cd ../backend
   go mod download
   ```

   При первом запуске автоматически создаётся база данных `users.db`.

## Запуск

```bash
cd backend
go run main.go
```

Приложение будет доступно по адресу `http://localhost:8080` и будет обслуживать статические файлы из `frontend/dist`.

## Запуск в Docker

Готовый образ приложения доступен на Docker Hub. Его можно использовать, если не хочется собирать фронтенд и бэкенд вручную.

```bash
# загрузить последнюю версию образа
docker pull foxisfox/ssh-gate:latest

# запустить контейнер
docker run -p 8080:8080 \
  -v $PWD/users.db:/app/backend/users.db \
  -v $PWD/authorized_keys:/app/backend/authorized_keys \
  foxisfox/ssh-gate:latest
```

После запуска приложение будет доступно по адресу `http://localhost:8080`. База данных и файл `authorized_keys` будут сохранены на хосте.

## API

### Пользователи

- `POST /api/users` – создать пользователя.
- `GET /api/users` – список пользователей.
- `GET /api/users/{id}` – пользователь по ID.
- `PUT /api/users/{id}` – обновить пользователя.
- `DELETE /api/users/{id}` – удалить пользователя и отозвать его ключи со всех серверов.

### Серверы

- `POST /api/servers` – добавить сервер.
- `GET /api/servers` – список серверов.
- `GET /api/servers/{id}` – сервер по ID.
- `PUT /api/servers/{id}` – обновить сервер.
- `DELETE /api/servers/{id}` – удалить сервер и отозвать ключи всех пользователей.

### Доступ пользователей

- `POST /api/users/{userId}/servers/{serverId}` – выдать доступ пользователю.
- `GET /api/users/{userId}/servers` – серверы, доступные пользователю.
- `DELETE /api/users/{userId}/servers/{serverId}` – отозвать доступ.

При выдаче доступа публичный ключ пользователя добавляется в `authorized_keys` целевого сервера. При удалении доступа ключ из него удаляется.

## Безопасность

- Публичные ключи дополнительно сохраняются на хосте приложения в файле `authorized_keys`.
- Следите за правами на приватные ключи и не передавайте их третьим лицам.
